{% extends 'base.html' %}
{% include 'navbar.html' %}

{% block body %}
<div class="container mt-4">
    <h2 class="text-center text-primary mb-4">Recent Parking History</h2>

    {% if reservations %}
    <table class="table table-bordered shadow">
        <thead class="table-secondary">
            <tr>
                <th>ID</th>
                <th>Location</th>
                <th>Vehicle No</th>
                <th>Parked At</th>
                <th>Parked Out At</th>
                <th>Amount Paid</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for r in reservations %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.spot.parking_lot.location_name if r.spot and r.spot.parking_lot else 'N/A' }}</td>
                <td>{{ r.vehicle_number }}</td>
                <td>{{ r.parking_in_time.strftime('%Y-%m-%d %H:%M') if r.parking_in_time else 'N/A' }}</td>
                <td>{{ r.parking_out_time.strftime('%Y-%m-%d %H:%M') if r.parking_out_time else 'Ongoing' }}</td>
                <td>{{ r.total_amount }}</td>
                <td>
                    {% if r.status == 'active' %}
                        <a href="{{ url_for('release_spot', reservation_id=r.id) }}" class="btn btn-outline-warning btn-sm">Release</a>
                    {% else %}
                        <span class="btn btn-success btn-sm disabled">Parked Out</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-muted text-center">No reservations yet.</p>
    {% endif %}

    <hr class="my-5">

    <h2 class="text-center text-primary mb-4">Book a New Parking Spot</h2>

    {% if lots %}
    <table class="table table-bordered shadow">
        <thead class="table-secondary">
            <tr>
                <th>Lot ID</th>
                <th>Location</th>
                <th>Address</th>
                <th>Available Spot</th>
                <th>Price Per Hour</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for lot in lots %}
            <tr>
                <td>{{ lot.id }}</td>
                <td>{{ lot.location_name }}</td>
                <td>{{ lot.address }}</td>
                <td>{{ lot.available_spots }}</td>
                <td>{{ lot.price_per_hour }}</td>
                <td>
                    {% if lot.available_spots > 0 %}
                        <a href="{{ url_for('book_spot', lot_id=lot.id) }}" class="btn btn-primary btn-sm">Book</a>
                    {% else %}
                        <button class="btn btn-outline-secondary btn-sm" disabled>No Spots</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-muted text-center">No parking lots available.</p>
    {% endif %}
</div>
{% endblock %}
